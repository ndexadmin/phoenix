<!DOCTYPE html>
<html th:lang="${#locale.language}" lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title th:text="#{login.title}">NDEX Login</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>

    <style>
        body { background-color:#ffffff; min-height:100vh; display:flex; }
        .left-bg{
          width:50%;
          background-image:url('https://ndexsystems.com/wp-content/themes/ndex/assets/images/banner-shape.png');
          background-size:cover; background-position:center;
        }
        .login-wrapper{ width:50%; display:flex; align-items:center; justify-content:center; padding:60px; }
        .logo-title{ font-size:45px; font-weight:900; letter-spacing:1px; }
        .logo-x{ color:#32c543; }
        .subtitle{ font-size:18px; margin-bottom:30px; color:#555; }
        .form-control{ background-color:#eef3ff; }
        .btn-login{ background-color:#1bb129; border:none; padding:10px 40px; font-size:18px; }
        .btn-login:hover{ background-color:#159a22; }
    </style>
</head>

<body>

<!-- LEFT SIDE BACKGROUND -->
<div class="left-bg d-none d-md-block"></div>

<!-- LOGIN CONTENT -->
<div class="login-wrapper">
    <div class="w-100" style="max-width:460px;">
        <!-- LOGO -->
        <div class="mb-4 text-center">
            <span class="logo-title">NDE<span class="logo-x">X</span></span>
            <div class="text-muted" th:text="#{login.tagline}">Own Your Data</div>
        </div>

        <!-- PAGE SUBTITLE -->
        <div class="subtitle text-center" th:text="#{login.demo}">F-ENGINE DEMO</div>

        <!-- LANG SWITCH (optionnel) -->
        <div class="text-end mb-3 small">
            <span th:text="#{login.choose.language}">Language</span> :
            <a th:href="@{/{product}/{locale}/{firmId}/login(
                 product=${product},
                 locale='en',
                 firmId=${firmId},
                 lang='en')}"
               class="link-secondary" th:text="#{login.lang.en}">English</a> |
            <a th:href="@{/{product}/{locale}/{firmId}/login(
                 product=${product},
                 locale='fr',
                 firmId=${firmId},
                 lang='fr')}"
               class="link-secondary" th:text="#{login.lang.fr}">Français</a>
        </div>


        <!-- FORM -->
        <form id="loginForm" onsubmit="return false;">
            <!-- paramètres de contexte -->
            <input type="hidden" id="locale"  th:value="${locale}"/>
            <input type="hidden" id="firmId"  th:value="${firmId}"/>
            <input type="hidden" id="product" th:value="${product}"/>

            <label class="form-label" for="loginId" th:text="#{ID.Conseiller}">User ID</label>
            <input type="text" id="loginId" name="loginId" class="form-control mb-3" value="sysadmin"/>

            <label class="form-label" for="password" th:text="#{Mot.de.passe}">Password</label>
            <div class="input-group mb-3">
                <input type="password" id="password" name="password" class="form-control" value="ndexsys50"/>
                <button class="input-group-text" type="button" onclick="togglePwd()">
                    <i class="bi bi-eye"></i>
                </button>
            </div>

            <div class="mt-4 text-end">
                <button type="button" class="btn btn-login text-white" onclick="login()" th:text="#{login.button}">Login</button>
            </div>
        </form>
    </div>
</div>`

<!-- Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"/>

<!-- Localized JS -->
<script th:inline="javascript">
    const i18nInvalid = /*[[#{login.invalid}]]*/ 'Invalid login';

    function togglePwd(){
      const p = document.getElementById('password');
      p.type = (p.type === 'password') ? 'text' : 'password';
    }

    async function login() {
      const loginId = document.getElementById("loginId").value;
      const password = document.getElementById("password").value;
      const product = document.getElementById("product").value;
      const locale  = document.getElementById("locale").value;
      const firmId  = document.getElementById("firmId").value;

      const url = `/phoenix/${product}/${locale}/${firmId}/login`;

      const response = await fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ loginId, password })
      });

      const data = await response.json();
      if (data && data.authenticated === true) {
        window.location.href = `/phoenix/${product}/${locale}/${firmId}/activity`;
      } else {
        alert(i18nInvalid);
      }
    }
</script>
</body>
</html>
